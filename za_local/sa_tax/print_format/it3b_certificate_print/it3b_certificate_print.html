{%- set company_doc = frappe.get_doc("Company", doc.company) -%}

<style>
	.it3b-cert {
		font-family: Arial, Helvetica, sans-serif;
		font-size: 11pt;
		line-height: 1.5;
		color: #000;
	}
	.it3b-cert .header {
		text-align: center;
		margin-bottom: 30px;
		border-bottom: 3px solid #003366;
		padding-bottom: 20px;
	}
	.it3b-cert .cert-title {
		font-size: 28pt;
		font-weight: bold;
		color: #003366;
		text-transform: uppercase;
		margin-bottom: 10px;
	}
	.it3b-cert .cert-subtitle {
		font-size: 14pt;
		color: #666;
	}
	.it3b-cert .company-logo {
		max-width: 150px;
		max-height: 60px;
		margin-bottom: 15px;
	}
	.it3b-cert .info-section {
		margin: 30px 0;
		padding: 20px;
		background-color: #f8f9fa;
		border-left: 4px solid #003366;
	}
	.it3b-cert .section-label {
		font-weight: bold;
		font-size: 10pt;
		color: #003366;
		text-transform: uppercase;
		margin-bottom: 8px;
	}
	.it3b-cert .info-grid {
		display: table;
		width: 100%;
		margin: 15px 0;
	}
	.it3b-cert .info-row {
		display: table-row;
	}
	.it3b-cert .info-cell {
		display: table-cell;
		padding: 8px;
		width: 50%;
	}
	.it3b-cert table.amounts {
		width: 100%;
		border-collapse: collapse;
		margin: 20px 0;
	}
	.it3b-cert table.amounts th {
		background-color: #003366;
		color: white;
		padding: 12px;
		text-align: left;
		font-weight: bold;
		border: 1px solid #002244;
	}
	.it3b-cert table.amounts td {
		padding: 10px;
		border: 1px solid #ddd;
	}
	.it3b-cert table.amounts tr:nth-child(even) {
		background-color: #f9f9f9;
	}
	.it3b-cert .text-right {
		text-align: right;
	}
	.it3b-cert .total-row {
		background-color: #003366 !important;
		color: white;
		font-weight: bold;
		font-size: 14pt;
	}
	.it3b-cert .total-row td {
		border: 1px solid #002244 !important;
	}
	.it3b-cert .footer {
		margin-top: 50px;
		padding-top: 20px;
		border-top: 2px solid #003366;
	}
	.it3b-cert .cert-number {
		background-color: #ffeaa7;
		padding: 10px;
		text-align: center;
		font-weight: bold;
		margin: 20px 0;
		border: 2px solid #fdcb6e;
	}
	@media print {
		.it3b-cert {
			font-size: 10pt;
		}
	}
</style>

<div class="it3b-cert">
	<!-- Header Section -->
	<div class="header">
		{% if company_doc.company_logo %}
		<img src="{{ company_doc.company_logo }}" class="company-logo" alt="{{ company_doc.name }}">
		{% endif %}
		<div class="cert-title">IT3(b) Certificate</div>
		<div class="cert-subtitle">Employer's Reconciliation Declaration</div>
		<div style="margin-top: 15px; font-size: 12pt;">
			<strong>{{ company_doc.name }}</strong>
		</div>
	</div>

	<!-- Certificate Number -->
	<div class="cert-number">
		Certificate Number: {{ doc.certificate_number or doc.name }}
	</div>

	<!-- Company Information -->
	<div class="info-section">
		<div class="section-label">Employer Information</div>
		<div class="info-grid">
			<div class="info-row">
				<div class="info-cell">
					<strong>Company Name:</strong><br>
					{{ company_doc.name }}
				</div>
				<div class="info-cell">
					<strong>Company Registration:</strong><br>
					{{ company_doc.company_registration or "N/A" }}
				</div>
			</div>
			<div class="info-row">
				<div class="info-cell">
					<strong>PAYE Reference Number:</strong><br>
					{{ company_doc.tax_id or "N/A" }}
				</div>
				<div class="info-cell">
					<strong>UIF Reference Number:</strong><br>
					{{ company_doc.get("uif_reference_number") or "N/A" }}
				</div>
			</div>
			<div class="info-row">
				<div class="info-cell" style="width: 100%;" colspan="2">
					<strong>Address:</strong><br>
					{{ company_doc.address_line1 or "" }}
					{% if company_doc.address_line2 %}, {{ company_doc.address_line2 }}{% endif %}
					<br>{{ company_doc.city or "" }}{% if company_doc.state %}, {{ company_doc.state }}{% endif %} {{ company_doc.pincode or "" }}
				</div>
			</div>
		</div>
	</div>

	<!-- Period Information -->
	<div class="info-section">
		<div class="section-label">Reconciliation Period</div>
		<div class="info-grid">
			<div class="info-row">
				<div class="info-cell">
					<strong>Tax Year:</strong><br>
					<span style="font-size: 14pt; font-weight: bold; color: #003366;">{{ doc.tax_year }}</span>
				</div>
				<div class="info-cell">
					<strong>Fiscal Period:</strong><br>
					<span style="font-size: 14pt; font-weight: bold; color: #003366;">{{ doc.fiscal_period }}</span>
				</div>
			</div>
			<div class="info-row">
				<div class="info-cell">
					<strong>Submission Date:</strong><br>
					{{ doc.get_formatted("submission_date") if doc.submission_date else "Not Submitted" }}
				</div>
				<div class="info-cell">
					<strong>Status:</strong><br>
					<span style="font-weight: bold; color: {{ 'green' if doc.status == 'Filed with SARS' else 'orange' if doc.status == 'Submitted' else 'red' }};">
						{{ doc.status or "Draft" }}
					</span>
				</div>
			</div>
		</div>
	</div>

	<!-- Statutory Amounts -->
	<div style="margin: 30px 0;">
		<div class="section-label">Statutory Contributions & Deductions</div>
		<table class="amounts">
			<thead>
				<tr>
					<th style="width: 60%;">Description</th>
					<th style="width: 40%;" class="text-right">Amount (ZAR)</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td><strong>Total PAYE (Pay As You Earn)</strong></td>
					<td class="text-right"><strong>{{ doc.get_formatted("total_paye") }}</strong></td>
				</tr>
				<tr>
					<td><strong>Total UIF (Unemployment Insurance Fund)</strong></td>
					<td class="text-right"><strong>{{ doc.get_formatted("total_uif") }}</strong></td>
				</tr>
				<tr>
					<td><strong>Total SDL (Skills Development Levy)</strong></td>
					<td class="text-right"><strong>{{ doc.get_formatted("total_sdl") }}</strong></td>
				</tr>
				<tr>
					<td><strong>Total ETI (Employment Tax Incentive) - Deduction</strong></td>
					<td class="text-right"><strong>({{ doc.get_formatted("total_eti") }})</strong></td>
				</tr>
				<tr class="total-row">
					<td><strong>TOTAL PAYABLE TO SARS</strong></td>
					<td class="text-right"><strong>{{ doc.get_formatted("total_payable") }}</strong></td>
				</tr>
			</tbody>
		</table>
	</div>

	<!-- Declaration -->
	<div style="margin: 40px 0; padding: 20px; background-color: #e8f4f8; border: 2px solid #003366;">
		<div class="section-label">Declaration</div>
		<p style="margin: 10px 0;">
			I, the undersigned, hereby declare that the information provided in this IT3(b) certificate is true and correct 
			to the best of my knowledge and belief. This reconciliation declaration has been prepared in accordance with 
			the requirements of the Income Tax Act and the Fourth Schedule.
		</p>
	</div>

	<!-- Footer Section -->
	<div class="footer">
		<div style="margin-top: 50px;">
			<table style="width: 100%; border: none;">
				<tr>
					<td style="width: 50%; border: none;">
						<div style="border-top: 2px solid #000; padding-top: 10px; margin-top: 60px;">
							<strong>Authorized Signatory</strong><br>
							<span style="font-size: 9pt;">Name & Signature</span>
						</div>
					</td>
					<td style="width: 50%; border: none; text-align: right;">
						<div style="border-top: 2px solid #000; padding-top: 10px; margin-top: 60px;">
							<strong>Date</strong><br>
							<span style="font-size: 9pt;">Date of Signature</span>
						</div>
					</td>
				</tr>
			</table>
		</div>

		<div style="margin-top: 30px; font-size: 9pt; color: #666; text-align: center;">
			This certificate is generated by {{ company_doc.name }}'s ERPNext system.<br>
			For SARS submissions, ensure this document is accompanied by all required supporting documentation.<br>
			Document generated on: {{ frappe.utils.now() }}
		</div>

		<div style="margin-top: 20px; padding: 10px; background-color: #fff3cd; border: 1px solid #ffc107;">
			<strong>Important Note:</strong> This IT3(b) certificate must be submitted to SARS by the required deadline. 
			Ensure all EMP201 monthly submissions have been completed before filing this reconciliation.
		</div>
	</div>
</div>

